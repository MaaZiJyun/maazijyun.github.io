<!-- This is the outermost frame -->
<!-- Create by MaaZiJyun on 27 Aug 2022 -->
<!DOCTYPE html>
<html>
  <!-- the head of the html -->
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=0" name="viewport">
    <!-- more meta data settings -->
    
       <meta name="author" content="Domuki"> 
     
    
        <meta name="subtitle" content="Welcome to My Home"> 
     
    
        <meta name="description" content="Welcome to visit my personal blog. I usually write some notes and articales here to share with others. Hope you could find what you are interested in"> 
    
     
    <!-- generate the title of the web page -->
     

    <!-- the title of the web page -->
    <title>
        Urllib in Python
    </title>

    <!-- the icon of the web page -->
    
        <link rel="icon" href="/img/domukiico.ico ">
     

    <!-- CSS list -->
     
         
            
                <link rel="stylesheet" href="/css/style.css ">
            
                <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css ">
             
         
     
    <!-- JS list -->
     
         
            
                <script src="/js/helper.css "></script>
            
                <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js "></script>
             
         
     
<meta name="generator" content="Hexo 6.2.0"></head>
  <!-- the body of the html -->
  <!-- The interface to connect the body content -->
<body>

  <!-- the header of the page -->
   
    
  <header class="header" style="background-color: black;">
    
  <!-- Navigation-->
  <nav class="navbar navbar-expand-lg navbar-dark justify-content-center">
    <div class="container p-2">
      <a href="/" class="navbar-brand logo">
        Domuki' Blog
      </a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarResponsive"
        aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation"><span
          class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarResponsive">
        <ul class="navbar-nav ms-auto">
          
            <li class="nav-item">
              <a href="/" class="nav-link active">
                Home
              </a>
            </li>
            
            <li class="nav-item">
              <a href="/archives" class="nav-link active">
                Archives
              </a>
            </li>
            
            <li class="nav-item">
              <a href="/categories" class="nav-link active">
                Categories
              </a>
            </li>
            
            <li class="nav-item">
              <a href="/tags" class="nav-link active">
                Tags
              </a>
            </li>
            
            <li class="nav-item">
              <a href="/about" class="nav-link active">
                About
              </a>
            </li>
            
        </ul>
      </div>
    </div>
  </nav>
</header> 
   

  <!-- the main part of the page -->
  <div class="content">

    <main class="main">

      <div class="main-content">

        <!-- if the current page is home, then the content of hone will be shown up -->
        
          <section>
    <div class="container mb-5">
        <article class="article">
            <div class="article-header">
                <div class="article-title">
                    <span class="article-title-text">
                        Urllib in Python
                    </span>
                </div>
                <div class="post-meta">
                    <span class="post-time">
                        2020-10-09
                    </span>
                </div>
            </div>

            <div class="article-body row">
                <div class="col-md-8">
                    <div class="post-content">
                        <h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><h3 id="What-is-Urllib"><a href="#What-is-Urllib" class="headerlink" title="What is Urllib?"></a>What is Urllib?</h3><blockquote>
<p><code>urllib</code> is a package that collects several modules for working with URLs</p>
</blockquote>
<span id="more"></span>

<p>This package has 4 modules: <code>urllib.request</code>, <code>urllib.error</code>, <code>urllib.parse</code> and <code>urllib.robotparser</code>.</p>
<ul>
<li><code>urllib.request</code> for opening and reading URLs</li>
<li><code>urllib.error</code> containing the exceptions raised by <code>urllib.request</code></li>
<li><code>urllib.parse</code> for parsing URLs</li>
<li><code>urllib.robotparser</code> for parsing <code>robots.txt</code> files</li>
</ul>
<p><code>urllib.request</code> and <code>urllib.error</code> are usually used in Web crawler program.</p>
<h2 id="Send-Request"><a href="#Send-Request" class="headerlink" title="Send Request"></a>Send Request</h2><p>We need <code>urllib.request</code> when sending a HTTP request as the Chrome. It can be used not only to send requests but also to gain the return. Just <code>urllopen()</code> alone can help us to do the work. This is the API.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">urllib.request.urlopen(url, data=None, [timeout, ]*, cafile=None, capath=None, cadefault=False, context=None)</span><br></pre></td></tr></table></figure>

<p>the parameters:</p>
<ol>
<li>string type: URL address</li>
<li><code>data</code> is the content in bytes type. It can be converted into a byte stream by the bytes() function. It is also an optional parameter. Using the data parameter, the request method becomes a POST method to submit the form. The standard format used is <code>application/x-www-form-urlencoded</code></li>
<li><code>timeout</code> is Request timeout in second.</li>
<li><code>cafile</code> and <code>capath</code> represents the CA certificate and the path of the CA certificate. You need to use HTTPS.</li>
<li><code>context</code> must be <code>ssl.SSLContext</code> type, which is used to set <code>ssl</code></li>
<li><code>cedefault</code> are abandoned</li>
</ol>
<p>The method will return a object of <code>http.client.HTTPResponse</code></p>
<h3 id="simply-grabbing-website"><a href="#simply-grabbing-website" class="headerlink" title="simply grabbing website"></a>simply grabbing website</h3><p>We can use <code>urllib.request.urllopen()</code> to request my blog site and grab the source code of the page.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://domuki.top&quot;</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">  response = urllib.request.urlopen(url)</span><br><span class="line">  html = response.read()		<span class="comment"># get the source code of page</span></span><br><span class="line">  <span class="built_in">print</span>(html.decode(<span class="string">&#x27;utf-8&#x27;</span>))	<span class="comment"># transform to utf-8</span></span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">  <span class="built_in">print</span>(<span class="string">&quot;request failed&quot;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="Setting-request-Timeout"><a href="#Setting-request-Timeout" class="headerlink" title="Setting request Timeout"></a>Setting request Timeout</h3><p>Some requests cannot be replied, which may be caused by network problem. Therefore, we can set timeout for our requests. We can abandon the requests we sent or send it one more time, if it times out. </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response = urllib.request.urlopen(url, timeout=<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<h3 id="Using-Data-parameter-to-submit-data"><a href="#Using-Data-parameter-to-submit-data" class="headerlink" title="Using Data parameter to submit data"></a>Using Data parameter to submit data</h3><p>We need to use data parameter when requesting some websites requiring it.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urilib.parse</span><br><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://127.0.0.1:8000&quot;</span></span><br><span class="line">params = &#123;</span><br><span class="line">  <span class="string">&#x27;name&#x27;</span>:<span class="string">&#x27;Alex&#x27;</span>,</span><br><span class="line">  <span class="string">&#x27;matric&#x27;</span>:<span class="string">&#x27;991204&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">data = <span class="built_in">bytes</span>(urllib.parse.urlencode(params), encoding=<span class="string">&#x27;utf8&#x27;</span>)</span><br><span class="line">response = urllib.request.urlopen(url, data=data)</span><br><span class="line"><span class="built_in">print</span>(response.read().decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br></pre></td></tr></table></figure>

<p>variable <code>params</code> is a dictionary actually, so we need <code>urllib.parse.urlencode()</code> help us to transform it to Strings. Then, use <code>bytes()</code> to convert it to a byte stream. Finally, use <code>urlopen()</code> to initiate a request that simulates the submission of form data in POST.</p>
<h3 id="Using-Request"><a href="#Using-Request" class="headerlink" title="Using Request"></a>Using Request</h3><p>Request Constructor: </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">urllib.request.Request(url, data=None, headers=&#123;&#125;, origin_req_host=None, unverifiable=False, method=None)</span><br></pre></td></tr></table></figure>

<p><code>url</code>: address link</p>
<p><code>data</code>: its usage is same as <code>data</code>  in <code>urlopen()</code></p>
<p><code>headers</code>: should be a dictionary, and will be treated as if <code>add_header()</code> was called with each key and value as arguments.</p>
<p><code>origin_req_host</code>: the host name and IP address of Requestor</p>
<p><code>unverifiable</code>: showing whether this request cannot be verified and it’s false by default. If we, for example, request for images in HTML but we don’t have the permission to do that automatically, so we have to turn the value True.</p>
<p><code>method</code>: the ways of sending HTTP requests, such as GET, POST, DELETE, PUT and so on.</p>
<h4 id="Simply-using"><a href="#Simply-using" class="headerlink" title="Simply using"></a>Simply using</h4><p>Use <code>Request</code> to send a HTTP requests as browser. If the <code>User-Agent</code> in the <code>headers</code> is not set, the <code>User-Agent</code> is <code>Python-urllib/3.5</code> by default. Some websites may reject the request, if your requests is not send as browser. The <code>User-Agent</code> I use is the Chrome.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://tieba.baidu.com/&quot;</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.87 Safari/537.36&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line">request = urllib.request.Request(url=url, headers=headers)</span><br><span class="line">response = urllib.request.urlopen(request)</span><br><span class="line"><span class="built_in">print</span>(response.read().decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br></pre></td></tr></table></figure>

<h5 id="Looking-for-the-latest-Chrome-user-agent"><a href="#Looking-for-the-latest-Chrome-user-agent" class="headerlink" title="Looking for the latest Chrome user agent?"></a>Looking for the latest Chrome user agent?</h5><p>Check this out:  <a target="_blank" rel="noopener" href="https://www.whatismybrowser.com/guides/the-latest-user-agent/chrome">latest Chrome User agent</a> </p>
<h4 id="Advanced-using"><a href="#Advanced-using" class="headerlink" title="Advanced using"></a>Advanced using</h4><p>If we need to add a proxy to the request and process the <strong>cookies</strong> of the request, we need to use <code>Handler</code> and <code>OpenerDirector</code>.</p>
<h3 id="Using-proxy"><a href="#Using-proxy" class="headerlink" title="Using proxy"></a>Using proxy</h3><p>Some websites set the limitation of viewing frequency. So if we request the websites highly frequently, the websites will ban our IP. Therefore, we need:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://domuki.top/&quot;</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 6.1; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.87 Safari/537.36&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">proxy_handler = urllib.request.ProxyHandler(&#123;</span><br><span class="line">    <span class="string">&#x27;http&#x27;</span>: <span class="string">&#x27;web-proxy.oa.com:8080&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;https&#x27;</span>: <span class="string">&#x27;web-proxy.oa.com:8080&#x27;</span></span><br><span class="line">&#125;)</span><br><span class="line">opener = urllib.request.build_opener(proxy_handler)</span><br><span class="line">urllib.request.install_opener(opener)</span><br><span class="line"></span><br><span class="line">request = urllib.request.Request(url=url, headers=headers)</span><br><span class="line">response = urllib.request.urlopen(request)</span><br><span class="line"><span class="built_in">print</span>(response.read().decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br></pre></td></tr></table></figure>

<h3 id="Login"><a href="#Login" class="headerlink" title="Login"></a>Login</h3><p>Some websites can be visited as long as we login it with correct username and password. When we meet this situation, we need use <code>HTTPPasswordMgrWithDefaultRealm()</code> to instantiate an object to manage account. Use <code>add_password()</code> add account and password. Then use <code>HTTPBasicAuthHandler()</code> to get hander. And get the opener object by <code>build_opener()</code>. Finally, use <code>open()</code> to send requests.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://▯▯▯▯▯.com/&quot;</span></span><br><span class="line">user = <span class="string">&#x27;user&#x27;</span>			<span class="comment"># username</span></span><br><span class="line">password = <span class="string">&#x27;password&#x27;</span>	<span class="comment"># password</span></span><br><span class="line">pwdmgr = urllib.request.HTTPPasswordMgrWithDefaultRealm()</span><br><span class="line">pwdmgr.add_password(<span class="literal">None</span>，url ，user ，password)</span><br><span class="line"></span><br><span class="line">auth_handler = urllib.request.HTTPBasicAuthHandler(pwdmgr)</span><br><span class="line">opener = urllib.request.build_opener(auth_handler)</span><br><span class="line">response = opener.<span class="built_in">open</span>(url)</span><br><span class="line"><span class="built_in">print</span>(response.read().decode(<span class="string">&#x27;utf-8&#x27;</span>))</span><br></pre></td></tr></table></figure>

<h3 id="Setting-Cookies"><a href="#Setting-Cookies" class="headerlink" title="Setting Cookies"></a>Setting Cookies</h3><p>If we need login every time we requesting, we can use cookies to do it automatically. </p>
<p>To obtain cookies, you need to use <code>http.cookiejar.CookieJar()</code> to instantiate a Cookies . Then use <code>urllib.request.HTTPCookieProcessor</code> to construct a handler object. Finally, use the <code>open()</code>.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> http.cookiejar</span><br><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"></span><br><span class="line">url = <span class="string">&quot;http://tieba.baidu.com/&quot;</span></span><br><span class="line">fileName = <span class="string">&#x27;cookie.txt&#x27;</span></span><br><span class="line"></span><br><span class="line">cookie = http.cookiejar.CookieJar()</span><br><span class="line">handler = urllib.request.HTTPCookieProcessor(cookie)</span><br><span class="line">opener = urllib.request.build_opener(handler)</span><br><span class="line">response = opener.<span class="built_in">open</span>(url)</span><br><span class="line"></span><br><span class="line">f = <span class="built_in">open</span>(fileName,<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> cookie:</span><br><span class="line">    f.write(item.name+<span class="string">&quot; = &quot;</span>+item.value+<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure>


                    </div>
                </div>
                <div class="col-md-4">
                    <div class="position-sticky" style="top: 2rem;">
                        <!-- archives list by date -->
                        <div class="home-archive">
                            <div class="p-4">
                                <h4>Other Archives</h4>
                                <ol class="list-unstyled mb-0">
                                    <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">June 2021</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a><span class="archive-list-count">6</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a><span class="archive-list-count">8</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a><span class="archive-list-count">7</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a><span class="archive-list-count">18</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a><span class="archive-list-count">5</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a><span class="archive-list-count">24</span></li></ul>
                                </ol>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </article>
    </div>
</section>

        <!-- show the content of a category -->
        
      </div>
      
    </main>

  </div>
  <!-- the footer of the page -->
  <!-- Footer -->
<footer class="blog-footer font-small">

    <!-- Footer Elements -->
    <div class="footer-icons container">
  
      <!-- Grid row-->
      <div class="row">
  
        <!-- Grid column -->
        
          <div class="flex-center">
            <!-- Facebook -->
             
            <!-- Twitter -->
             
            <!-- Google +-->
             
            <!--Instagram-->
             
            <!--Pinterest-->
             
          </div>
        
        <!-- Grid column -->
  
      </div>
      <!-- Grid row-->
  
    </div>
    <!-- Footer Elements -->
  
    <!-- Copyright -->
    <div class="footer-copyright text-center mt-3">© 2020 Copyright:
      <a href="https://domuki.top ">https://domuki.top</a>
    </div>
    <!-- Copyright -->
  
  </footer>
  <!-- Footer --> 
  <button class="back-top" onclick="topFunction()">
    Top
  </button>
  <script>
    //Get the button
    var mybutton = document.getElementsByClassName("back-top");
    
    // When the user scrolls down 20px from the top of the document, show the button
    window.onscroll = function() {scrollFunction()};
    
    function scrollFunction() {
      if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
        mybutton[0].style.display = 'block';
      } else {
        mybutton[0].style.display = 'none';
      }
    }
    
    // When the user clicks on the button, scroll to the top of the document
    function topFunction() {
      document.body.scrollTop = 0;
      document.documentElement.scrollTop = 0;
    }
    </script>
  
</body>

 
</html>